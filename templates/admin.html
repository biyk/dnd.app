<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <title>Out of the Abyss - Map with Drawing Tools</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <script>window.admin_mode=1</script>
</head>
<body>

<!-- Панель навигации по вкладкам -->
<div class="tab-buttons">
    <button class="tab-button active" onclick="showTab('map')">Карта</button>
    <button class="tab-button" onclick="showTab('ambience-tab')">Амбиенс</button>
    <button class="tab-button" onclick="showTab('initiative-tab')">Инициатива</button>
    <button class="tab-button" onclick="showTab('dm-tab')">Для заметок</button>
    <button class="tab-button" onclick="showTab('monster-tab')">Зоны</button>
</div>

<!-- Контейнеры для содержимого каждой вкладки -->

<div id="map" class="tab-content active">

</div>
    <!-- Кнопки для карты -->
<div id="map-controls" class="tab-content active">
    <button id="draw-button">Draw Polygon</button>
    <button id="reverse-button">Reverse Button</button>
</div>
<div id="ambience-tab" class="tab-content">
    <h2>Амбиенс</h2>
    <p>Здесь можно настроить амбиенс, выбрать звуковое сопровождение и эффекты для карты.</p>
    <div id="ambience-tab-content"></div>
</div>
<div id="initiative-tab" class="tab-content">
    <h2>Инициатива</h2>
    <p>Таблица инициативы для отслеживания очереди ходов персонажей.</p>
    <div class="container"><!-- Информационные блоки --><div class="info-block">
        <span>Текущий раунд: <span id="current-round"></span></span>
        <span>Ходит: <span id="current-turn"></span></span>
        <span>Далее: <span id="next-turn"></span></span>
        <span>Сложность боя: <span id="battle-rating"></span></span>
    </div>
        <button class="toggle-form-button reset" onclick="resetInitiative()">Сброс</button>
        <button class="toggle-form-button next" >Дальше</button>
        <button class="toggle-form-button prev">Назад</button>
        <!-- Контейнер для персонажей -->
        <div id="characters-container"></div>
        <!-- Кнопка открытия формы добавления персонажа -->
        <button class="toggle-form-button add">Добавить персонажа</button>
        <input type="text" id="npc-input" placeholder="Type to search NPCs..."><ul id="npc-list"></ul>
        <script></script>
        <!-- Форма добавления нового персонажа -->
        <div class="add-character-form" id="add-character-form"><label>Init: <input type="text" id="new-init"></label><label>Имя: <input type="text" id="new-name"></label><label>КД: <input type="text" id="new-cd"></label><label>HP: <input type="text" id="new-hp-now"> / <input type="text" id="new-hp-max"></label><label>SUR: <input type="checkbox" id="new-surprise"></label><label>НПС: <input type="checkbox" id="new-npc" /></label><label>Опасность: <input type="text" id="new-experience" /></label><button id="add-character-button">Добавить</button></div>
    </div>
</div>
<div id="dm-tab" class="tab-content">
    <h2>Заметки</h2>
    <textarea  id="dynamic-text" style="width: 800px;height:50%"></textarea>
</div>
<div id="monster-tab" class="tab-content">
    <h2>Локации</h2>
<style>
    /* Список подлокаций */
    ul#sub-locations {
        padding-left: 20px;
    }

    ul#sub-locations li {
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
        margin: 5px 0;
        border: 1px solid #ddd;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    ul#sub-locations li:hover {
        background-color: #e8f5e9;
        transform: scale(1.02);
    }

    /* Кнопки */
    .location button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .location button:hover {
        background-color: #45a049;
    }

    .location button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }

    /* Форма добавления локации */
    #add-location-form {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: none;
        margin-top: 20px;
    }

    #add-location-form h3 {
        margin-top: 0;
    }

    #add-location-form input {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fafafa;
        transition: border-color 0.3s ease;
    }

    #add-location-form input:focus {
        border-color: #4CAF50;
        outline: none;
    }

    /* Попап редактирования локации */
    #edit-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
        width: 90%;
        max-width: 400px;
    }

    #edit-popup h3 {
        margin-top: 0;
        font-size: 20px;
    }

    #edit-popup input {
        width: 100%;
        padding: 10px 0px 10px 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        background-color: #fafafa;
    }

    #edit-popup input:focus {
        border-color: #4CAF50;
        outline: none;
    }

    #edit-popup h4 {
        margin-bottom: 10px;
    }

    #npc-list {
        list-style: none;
        padding-left: 0;
    }

    #npc-list li {
        background-color: #f1f1f1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 5px;
    }

    /* Поле поиска персонажей */
    #loc-npc-input {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fafafa;
        margin-bottom: 15px;
    }

    #loc-npc-input:focus {
        border-color: #4CAF50;
        outline: none;
    }

    #npc-search-results {
        list-style: none;
        padding: 0;
        margin-top: 10px;
        max-height: 150px;
        overflow-y: auto;
    }

    #npc-search-results li {
        background-color: #ffffff;
        border: 1px solid #ddd;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #npc-search-results li:hover {
        background-color: #e8f5e9;
    }

    /* Затемнение фона при открытии попапа */
    #popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
    }

    /* Адаптивность для мобильных устройств */
    @media (max-width: 600px) {
        ul#sub-locations li {
            font-size: 14px;
        }

        #edit-popup {
            width: 95%;
        }
    }
</style>


    <label for="main-location">Выберите основную локацию:</label>
    <select id="main-location">
        <option value="">Загрузить...</option>
    </select>

    <h2>Подлокации</h2>
    <ul id="sub-locations">
        <li>Загружаются...</li>
    </ul>

    <button id="add-location-btn" class="location">Добавить новую локацию</button>

    <div id="add-location-form">
        <h3>Добавить новую локацию</h3>
        <label for="location-name">Имя локации:</label>
        <input type="text" id="location-name" required>
        <button id="save-location" class="location">Сохранить</button>
        <button id="cancel-location" class="location">Отмена</button>
    </div>

<!-- Попап редактирования локации -->
<div id="edit-popup" style="display: none;">
    <h3>Редактировать локацию</h3>
    <label for="edit-name">Имя локации:</label>
    <input type="text" id="edit-name" required>

    <h4>Персонажи в этой локации</h4>
    <ul id="npc-list2">
        <li>Загружаются...</li>
    </ul>

    <h4>Добавить персонажа</h4>
    <label for="loc-npc-input">Поиск персонажа:</label>
    <input type="text" id="loc-npc-input" placeholder="Введите имя персонажа">
    <ul id="npc-search-results">
        <!-- Результаты поиска персонажей -->
    </ul>

    <button id="close-popup" class="location">Закрыть</button>
</div>

</div>
<script src="https://unpkg.com/@turf/turf"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script type="module" src="{{ url_for('static', filename='js/script.js') }}" async defer></script>
<script  type="module" src="{{ url_for('static', filename='js/tabs.js') }}" async defer></script>
<script type="module" src="{{ url_for('static', filename='js/init.js') }}" async defer></script>
<script src="{{ url_for('static', filename='js/textarea.js') }}" async defer></script>
<script src="{{ url_for('static', filename='js/ambience.js') }}" async defer></script>
<script type="module" src="{{ url_for('static', filename='js/locations.js') }}" async defer></script>
<script type="module" src="{{ url_for('static', filename='js/tests.js') }}" async defer></script>

</body>
</html>
