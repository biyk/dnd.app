---------------–ö–æ–¥ static\js\ambience.js:
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞–¥–∏–æ–±–∞—Ç—Ç–æ–Ω–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
async function loadAmbienceRadios() {
    try {
        const response = await fetch('/static/audio/ambience.json');
        const data = await response.json();

        let config = await fetch('/api/configs');
        let idata = await config.json();
        let ambience = idata.ambience;

        const container = document.getElementById('ambience-tab');
        Object.entries(data).forEach(([key, value]) => {
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'ambience';
            radio.value = key;
            radio.id = `radio-${key}`;
            radio.checked = key===ambience;
            const label = document.createElement('label');
            label.htmlFor = `radio-${key}`;
            label.textContent = value;
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫—É –∏ –º–µ—Ç–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            container.appendChild(radio);
            container.appendChild(label);
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏
            radio.addEventListener('change', async () => {
                try {
                    await fetch('/api/config/ambience', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ ambience: radio.value })
                    });
                    console.log(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ: ${radio.value}`);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:', error);
                }
            });
        });


    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    }
}
loadAmbienceRadios();

---------------–ö–æ–¥ static\js\init.js:
import {calculateEncounterData, debounce, createEditableSpan} from './init/func.js';
import {displayInfoBlocks,displayCurrentAndNextTurn, fillEditForm} from './init/display.js';
import {loadInitiativeData, sendInit, infoCharacter} from './init/api.js';

class InitiativeManager {
    constructor() {
        this.currentCharacterIndex = 0;
        this.currentRound = 1;
        this.charactersData = [];
        this.rating = 0;
        this.nextCharacterIndex = 0;

        // –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        this.addEventListeners();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON-—Ñ–∞–π–ª–∞
    loadInitiativeData() {
        loadInitiativeData.call(this);
    }

    displayInfoBlocks() {
        displayInfoBlocks.call(this);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    sendInit() {
        sendInit.call(this);
    }

    displayCharactersAndSendInit(){
        this.displayCharacters();
        this.sendInit();
    }

    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    updateCharacterProperty(index, property, value) {
        this.charactersData[index][property] = value;
        this.displayCharactersAndSendInit();
    }

    updateCharacterPropertyInit(index, property, value) {
        while (!this.isUniqueInitiative(value)) {
            value = (parseFloat(value) + 0.1).toFixed(1);
        }
        this.charactersData[index][property] = value;
        this.displayCharactersAndSendInit();
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–µ—Ä—Å–æ–Ω–∞–∂—É
    nextTurn() {
        let characters = this.charactersData.sort((a, b) => parseFloat(b.init) - parseFloat(a.init));
        let _characters = characters;

        if (this.currentRound === 0) {
            characters = characters.filter(character => character.surprise === "true");
        }

        let next = characters.filter(character => parseFloat(character.init) < this.currentCharacterIndex)[0] || _characters[0];

        this.currentCharacterIndex = next.init;
        if (next.init == characters[0].init) {
            this.currentRound++;
        }

        this.displayCharactersAndSendInit();
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–µ—Ä—Å–æ–Ω–∞–∂—É
    prevTurn() {
        let characters = this.charactersData.sort((a, b) => parseFloat(b.init) - parseFloat(a.init));

        if (this.currentRound === 0) {
            characters = characters.filter(character => character.surprise === "true");
        }

        let currentIndex = characters.findIndex(character => parseFloat(character.init) === parseFloat(this.currentCharacterIndex));

        if (currentIndex === 0) {
            this.currentCharacterIndex = characters[characters.length - 1].init;
            this.currentRound = Math.max(0, this.currentRound - 1);
        } else {
            this.currentCharacterIndex = characters[currentIndex - 1].init;
        }

        this.displayCharactersAndSendInit();
    }


    // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ
    displayCharacters() {
        const container = document.getElementById('characters-container');
        container.innerHTML = '';

        let { encounterDifficulty } = calculateEncounterData(this.charactersData);
        document.getElementById('battle-rating').textContent = encounterDifficulty;
        this.rating = encounterDifficulty;
        const characters = this.charactersData.sort((a, b) => parseFloat(b.init) - parseFloat(a.init));

        characters.forEach((character, index) => {
            const row = document.createElement('div');
            row.classList.add('character-row');
            if (character.init === this.currentCharacterIndex) row.classList.add('current-turn');
            row.classList.add(character.npc === 'true' ? 'character-npc' : 'character-player');

            const nameSpan = createEditableSpan(`–ò–º—è: ${character.name}`, "name", index, this.updateCharacterProperty.bind(this));
            const initSpan = createEditableSpan(`Init: ${character.init}`, "init", index, this.updateCharacterPropertyInit.bind(this));
            const cdSpan = createEditableSpan(`–ö–î: ${character.cd}`, "cd", index, this.updateCharacterProperty.bind(this));
            const hpSpan = createEditableSpan(`HP: ${character.hp_now}`, "hp_now", index, this.updateCharacterProperty.bind(this),`/ ${character.hp_max}`);
            const expSpanTitle = character.npc === 'true' ? 'DNG' : 'LVL';
            const expSpan = createEditableSpan(`${expSpanTitle}: ${character.exp}`, "exp", index, this.updateCharacterProperty.bind(this));

            const surpriseLabel = this.createCheckbox("Sur", character.surprise, index, 'surprise');
            const npcLabel = this.createCheckbox("–ù–ü–°", character.npc, index, 'npc');

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '-';
            deleteButton.onclick = () => this.deleteCharacter(index);

            const healButton = document.createElement('button');
            healButton.textContent = '+';
            healButton.onclick = () => this.healCharacter(index);

            const infoButton = document.createElement('button');
            infoButton.textContent = 'i';
            infoButton.classList.add('js-info');
            infoButton.onclick = () => this.infoCharacter(character.name);

            row.append(nameSpan, initSpan, cdSpan, hpSpan, surpriseLabel, npcLabel, expSpan, deleteButton, healButton, infoButton);
            container.appendChild(row);
        });

        displayCurrentAndNextTurn(this);
    }

    createCheckbox(labelText, isChecked, index, property) {
        const label = document.createElement('label');
        label.innerHTML = `${labelText}: <input type="checkbox" ${isChecked === "true" ? "checked" : ""} />`;
        label.querySelector("input").onchange = (e) => {
            this.updateCharacterProperty(index, property, e.target.checked ? 'true' : 'false');
        };
        return label;
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã
    resetInitiative() {
        this.charactersData.forEach((character) => (character.init = '0'));
        this.currentRound = 1;

        this.displayCharactersAndSendInit();
    }

    // –§—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è
    healCharacter(index) {
        this.charactersData[index].hp_now = this.charactersData[index].hp_max;
        this.displayCharactersAndSendInit();
    }

    // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    deleteCharacter(index) {
        this.charactersData.splice(index, 1);
        this.displayCharactersAndSendInit();
    }

        // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    toggleAddCharacterForm() {
        const form = document.getElementById('add-character-form');
        form.style.display = form.style.display === 'none' || form.style.display === '' ? 'grid' : 'none';
    }

    // –ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã
    isUniqueInitiative(init) {
        return !this.charactersData.some(character => parseFloat(character.init) === parseFloat(init));
    }

    // –ú–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    addCharacter() {
        let init = document.getElementById('new-init').value;
        const name = document.getElementById('new-name').value;
        const cd = document.getElementById('new-cd').value;
        const hpNow = document.getElementById('new-hp-now').value;
        const hpMax = document.getElementById('new-hp-max').value;
        const surprise = document.getElementById('new-surprise').checked;
        const npc = document.getElementById('new-npc').checked;
        const exp = document.getElementById('new-experience').value;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã
        while (!this.isUniqueInitiative(init)) {
            init = (parseFloat(init) + 0.1).toFixed(1);
        }

        const newCharacter = {
            init: init,
            name: name,
            cd: cd,
            hp_now: hpNow,
            hp_max: hpMax,
            exp: exp,
            surprise: surprise ? "true" : "false",
            npc: npc ? "true" : "false"
        };

        this.charactersData.push(newCharacter);
        this.toggleAddCharacterForm();
        this.displayCharactersAndSendInit();
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏
    fillEditForm(data) {
        fillEditForm(data);
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    addEventListeners() {
        if (typeof document !== "undefined") {
            document.querySelector(".toggle-form-button.reset").addEventListener("click", this.resetInitiative.bind(this));
            document.querySelector(".toggle-form-button.next").addEventListener("click", this.nextTurn.bind(this));
            document.querySelector(".toggle-form-button.prev").addEventListener("click", this.prevTurn.bind(this));
            document.querySelector(".toggle-form-button.add").addEventListener("click", this.toggleAddCharacterForm.bind(this)); // –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
            document.getElementById('add-character-button').addEventListener("click", this.addCharacter.bind(this)); // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞


            // –ò–∑–º–µ–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ø–∏—Å–∫–∞ –º–æ–Ω—Å—Ç—Ä–æ–≤
            document.getElementById('npc-input').addEventListener(
                'input',
                debounce(async () => {
                    const npcList = document.getElementById('npc-list');
                    const input = document.getElementById('npc-input'); // –ü–æ–ª—É—á–∞–µ–º input —ç–ª–µ–º–µ–Ω—Ç
                    const query = input.value.trim();
                    if (query.length === 0) {
                        npcList.innerHTML = '';
                        return;
                    }
                    try {
                        const response = await fetch(`/api/data/monsters/json?name=${encodeURIComponent(query)}`);
                        if (!response.ok) throw new Error('Error fetching data');
                        const data = await response.json();
                        npcList.innerHTML = data.map((npc, index) => `<li data-index="${index}" data-json='${JSON.stringify(npc)}'>${npc.name}</li>`).join('');

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞
                        Array.from(npcList.querySelectorAll('li')).forEach(li => {
                            li.addEventListener('click', (event) => {
                                const npcData = JSON.parse(event.target.getAttribute('data-json'));
                                initiativeManager.fillEditForm(npcData); // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
                            });
                        });
                    } catch (error) {
                        console.error('Error:', error);
                        npcList.innerHTML = '<li>Error loading NPCs</li>';
                    }
                }, 300) // –ó–∞–¥–µ—Ä–∂–∫–∞ 300 –º—Å
            );

        }
    }

    infoCharacter(name) {
        infoCharacter(name);
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
const initiativeManager = new InitiativeManager();
window.initiativeManager = initiativeManager;
initiativeManager.loadInitiativeData();
export { InitiativeManager };

---------------–ö–æ–¥ static\js\locations.js:
import { debounce } from './init/func.js';
import { loadMainLocations, loadSubLocations } from './locations/api.js';

export class LocationManager {
    constructor() {
        const el = id => document.getElementById(id);
        this.apiUrl = '/api/data/location';
        this.mainLocationSelect = el('main-location');
        this.subLocationList = el('sub-locations');
        this.addLocationBtn = el('add-location-btn');
        this.addLocationForm = el('add-location-form');
        this.locationNameInput = el('location-name');
        this.saveLocationBtn = el('save-location');
        this.cancelLocationBtn = el('cancel-location');
        this.editPopup = el('edit-popup');
        this.closePopup = el('close-popup');
        this.editNameInput = el('edit-name');
        this.editNpcList = el('npc-list2');
        this.searchNpcInput = el('loc-npc-input');
        this.searchNpcResults = el('npc-search-results');
        this.currentEditingLocationId = null;
        this.init();
    }

    async init() {
        await this.loadMainLocations();
        this.mainLocationSelect.addEventListener('change', () => this.loadSubLocations());
        this.addLocationBtn.addEventListener('click', () => this.toggleForm(true));
        this.saveLocationBtn.addEventListener('click', () => this.addNewLocation());
        this.cancelLocationBtn.addEventListener('click', () => this.toggleForm(false));
        this.searchNpcInput.addEventListener('input', debounce(() => this.searchNpc(), 300));
        this.editNameInput.addEventListener('keyup', debounce(() => this.editLocationName(), 300));//
        this.closePopup.addEventListener('click', () => this.hideEditPopup());
        this.mainLocationSelect.dispatchEvent(new Event('change'));
    }

    async loadMainLocations() {
        await loadMainLocations.call(this);
    }

    hideEditPopup() {
        this.editPopup.style.display = 'none';
        this.currentEditingLocationId = null;
    }

    async loadSubLocations() {
        await loadSubLocations.call(this);
    }

    async removeLocation(location) {
        try {
            const response = await fetch('/api/data/location/remove', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ location })
            });
            response.ok ? await this.loadSubLocations() : console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏:', error);
        }
    }

    toggleForm(show) {
        this.addLocationForm.style.display = show ? 'block' : 'none';
    }

    async addNewLocation() {
        const name = this.locationNameInput.value.trim();
        if (!name) return console.error('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏');
        try {
            const response = await fetch(this.apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, parent_id: this.mainLocationSelect.value })
            });
            if (response.ok) {
                this.toggleForm(false);
                this.locationNameInput.value = '';
                await this.loadSubLocations();
            } else {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏:', error);
        }
    }

    async showEditPopup(location) {
        this.currentEditingLocationId = location.ID;
        this.editPopup.style.display = 'block';
        this.editNameInput.value = location.name;
        this.editNameInput.dataset.id = location.ID;
        await this.loadNpcs(location.ID);
    }

    async loadNpcs(locationId) {
        try {
            const response = await fetch(`/api/data/locations/npc/?location_id=${locationId}`);
            const data = await response.json();
            this.editNpcList.innerHTML = data?.length
                ? data.map(npc => `
                    <li>
                        <span>${npc.name}</span>
                        <span class="location-del-npc" onclick="window.LocationManager.updateNpcInLocation(${npc.id}, 'remove')">X</span>
                        <span class="move-npc-btn" onclick="window.LocationManager.showLocationSelect(${npc.id})">‚û°</span>
                        <select class="npc-location-select hidden" data-npc-id="${npc.id}" onchange="window.LocationManager.moveNpcToNewLocation(${npc.id}, this.value)">
                            <option>–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é</option>
                            ${Array.from(this.subLocationList.children).map(loc => `<option value="${loc.dataset.locationId}">${loc.querySelector('.location-span').innerText}</option>`).join('')}
                        </select>
                    </li>`).join('')
                : '';
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:', error);
        }
    }

    async searchNpc() {
        const query = this.searchNpcInput.value.trim();
        if (!query) return (this.searchNpcResults.innerHTML = '');
        try {
            const response = await fetch(`/api/data/monsters/json?name=${encodeURIComponent(query)}`);
            const data = await response.json();
            this.searchNpcResults.innerHTML = data?.length
                ? data.map(npc => `<li data-monster-id="${npc.id}" onclick="window.LocationManager.updateNpcInLocation(${npc.id}, 'add')">${npc.name}</li>`).join('')
                : '';
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:', error);
        }
    }

    async updateNpcInLocation(monsterId, action) {
        if (!this.currentEditingLocationId) return;
        const url = `/api/data/locations/npc/${action}`;
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ location_id: this.currentEditingLocationId, monster_id: monsterId })
            });
            if (response.ok) {
                await this.loadNpcs(this.currentEditingLocationId);
                console.info(`–ü–µ—Ä—Å–æ–Ω–∞–∂ ${action === 'add' ? '–¥–æ–±–∞–≤–ª–µ–Ω' : '—É–¥–∞–ª–µ–Ω'} —É—Å–ø–µ—à–Ω–æ`);
            } else {
                console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ ${action === 'add' ? '–¥–æ–±–∞–≤–ª–µ–Ω–∏–∏' : '—É–¥–∞–ª–µ–Ω–∏–∏'} –ø–µ—Ä—Å–æ–Ω–∞–∂–∞`);
            }
        } catch (error) {
            console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ ${action === 'add' ? '–¥–æ–±–∞–≤–ª–µ–Ω–∏–∏' : '—É–¥–∞–ª–µ–Ω–∏–∏'} –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:`, error);
        }
    }

    showLocationSelect(npcId) {
        const select = document.querySelector(`.npc-location-select[data-npc-id="${npcId}"]`);
        select.classList.toggle('hidden');
    }

    async moveNpcToNewLocation(npcId, newLocationId) {
        try {
            // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏
            await fetch('/api/data/locations/npc/remove', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ location_id: this.currentEditingLocationId, monster_id: npcId })
            });

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–æ–≤—É—é –ª–æ–∫–∞—Ü–∏—é
            await fetch('/api/data/locations/npc/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ location_id: newLocationId, monster_id: npcId })
            });

            await this.loadNpcs(this.currentEditingLocationId);
            console.info('–ü–µ—Ä—Å–æ–Ω–∞–∂ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:', error);
        }
    }

    async editLocationName() {
        const name = this.editNameInput.value.trim();
        const location = this.editNameInput.dataset.id;
        try {
            const response = await fetch('/api/data/location/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name , location})
            });
            response.ok ? await this.loadSubLocations() : console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏');
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏:', error);
        }
    }
}

window.LocationManager = new LocationManager();


---------------–ö–æ–¥ static\js\npc.js:
import { debounce } from './init/func.js';
import { NpcApi } from './api/npc.js';

export class NpcManager {
    constructor() {
        const el = id => document.getElementById(id);
        this.apiUrl = '/api/data/location';
        // –°—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã
        this.searchNpcInput = el('npc-template-search');
        this.searchNpcResults = el('template-npc-search-results');
        this.addNpcButton = el('add-npc-button');
        this.updateNpcButton = el('update-npc-button');
        this.npcCd = el('npc-kd');
        this.npcId = el('npc-id');
        this.npcName = el('npc-name');
        this.npcHp = el('npc-health');
        this.npcTemplate = el('npc-template');
        this.npcForm = el('npc-form');
        this.monsters = new Map();
        this.NpcApi = new NpcApi();
        this.init();
    }

    async init() {
        this.searchNpcInput.addEventListener('input', debounce(() => this.searchNpc(), 300));
        this.addNpcButton.addEventListener('click', this.addNpcAction.bind(this));
        this.updateNpcButton.addEventListener('click', this.updateNpcAction.bind(this));
        await this.loadNpc()
    }

    async loadNpc() {
        this.NpcList = await this.NpcApi.getNpc();
        this.DisplayNpcList();
    }

    async addNpcAction() {
        await this.editNpcAction('add');
        this.npcForm.reset()
    }
    updateNpcAction (){
        this.addNpcButton.classList.remove('hidden');
        this.updateNpcButton.classList.add('hidden');

        this.editNpcAction('update').then(r => this.npcForm.reset())
    }

    async editNpcAction(action='add') {
        try {
            const response = await fetch('/api/data/npc/'+action, {
                method: 'POST',
                body: new FormData(this.npcForm)
            });
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã');
            const { message } = await response.json();
            console.info(message);
            await this.loadNpc();
        } catch (error) {
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error.message);
        }
    }

    async searchNpc() {
        const query = this.searchNpcInput.value.trim();
        if (!query) {
            this.searchNpcResults.innerHTML = '';
            return;
        }
        try {
            const response = await fetch(`/api/data/monsters/json?name=${encodeURIComponent(query)}`);
            const data = await response.json();
            this.monsters = new Map(data.map(npc => [npc.id, npc]));
            this.searchNpcResults.innerHTML = data.length
                ? data.map(npc => `<li data-monster-id="${npc.id}" onclick="window.NpcManager.useTemplate(${npc.id})">${npc.name}</li>`).join('')
                : '';
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π:', error);
        }
    }

    useTemplate(monsterId) {
        const npc = this.monsters.get(monsterId);
        if (npc) {
            this.npcCd.value = npc.armor_class || '';
            this.npcName.value = npc.name || '';
            this.npcHp.value = npc.hit_points || '';
            this.npcTemplate.value = npc.name || '';
        } else {
            console.error(`–®–∞–±–ª–æ–Ω NPC —Å ID ${monsterId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
        }
    }

    DisplayNpcList() {
        const npcListContent = document.getElementById('npc-list-content'); // –ü–æ–ª—É—á–∞–µ–º –±–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        if (!npcListContent) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç npc-list-content –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        npcListContent.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

        if (!this.NpcList || this.NpcList.length === 0) {
            npcListContent.innerHTML = '<p>–°–ø–∏—Å–æ–∫ NPC –ø—É—Å—Ç.</p>';
            return;
        }

        this.NpcList.forEach(npc => {
            const npcItem = document.createElement('div');
            npcItem.classList.add('npc-item');

            npcItem.innerHTML = `
                <div class="npc-details">
                    <p onclick="window.initiativeManager.infoCharacter('${npc.template}')">
                    <strong>–ò–º—è:</strong><span  class="js-npc-name">${npc.name}</span>
                    </p>
                    <p><strong>HP:</strong> ${npc.hp}</p>
                    <p><strong>CD:</strong> ${npc.cd || 'N/A'}</p>
                    <p><button class="js-edit-npc" onclick="window.NpcManager.editNpc('${npc.id}')">i</button></p>
                </div>
                <button class="delete-btn" data-id="${npc.id}">–£–¥–∞–ª–∏—Ç—å</button>
            `;

            npcListContent.appendChild(npcItem);
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
        npcListContent.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', event => {
                const npcId = event.target.getAttribute('data-id');
                this.deleteNpc(npcId);
            });
        });
    }

    async deleteNpc(npcId) {
        try {
            const response = await fetch(`/api/data/npc/delete/${npcId}`, { method: 'DELETE' });
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞');
            this.NpcList = this.NpcList.filter(npc => npc.id !== parseInt(npcId, 10)); // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
            this.DisplayNpcList(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
        } catch (error) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: ' + error.message);
        }
    }

    editNpc(id) {
        // –ò—â–µ–º NPC –≤ —Å–ø–∏—Å–∫–µ
        const npc = this.NpcList.find(npc => npc.id === parseInt(id, 10));

        if (!npc) {
            console.error(`NPC —Å ID ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
            return;
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ NPC
        this.npcCd.value = npc.cd || '';
        this.npcName.value = npc.name || '';
        this.npcHp.value = npc.hp || '';
        this.npcTemplate.value = npc.template || '';
        this.npcId.value = npc.id || '';
        document.getElementById('npc-custom-text').value = npc.text || '';

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
        this.addNpcButton.classList.add('hidden');
        this.updateNpcButton.classList.remove('hidden');

    }
}

window.NpcManager = new NpcManager();


---------------–ö–æ–¥ static\js\script.js:
import {getInit, getConfig, sendPolygonsData, checkForConfigUpdates} from './script/api.js';
import {createNumberedIcon, getParticipantHTML, updateInfoBar} from './script/helpers.js';
import {checkTab} from './tabs.js';
import {
    createMainPolygon,
    createPolygons,
    setPolygonClickability,
    toggleMainPolygonVisibility,
    updateMainPolygon
} from './script/poligons.js'
import {SlideMenu} from './script/makrer.js'

class MapManager {
    constructor() {
        this.mapName = ""; // –ò–º—è –∫–∞—Ä—Ç—ã
        this.mainPolygon = null; // –ì–ª–∞–≤–Ω—ã–π –ø–æ–ª–∏–≥–æ–Ω
        this.map = null; // –ö–∞—Ä—Ç–∞
        this.polygons = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è –ø–æ–ª–∏–≥–æ–Ω–æ–≤
        this.polygonPoints = []; // –¢–æ—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª–∏–≥–æ–Ω–∞
        this.polygonMarkers = []; // –ú–∞—Ä–∫–µ—Ä—ã —Ç–æ—á–µ–∫ –ø–æ–ª–∏–≥–æ–Ω–∞
        this.markerCount = 0; // –°—á—ë—Ç—á–∏–∫ –º–∞—Ä–∫–µ—Ä–æ–≤
        this.drawingMode = false; // –†–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        this.lastUpdated = 0; // –ü–æ—Å–ª–µ–¥–Ω—è—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        this.admin_mode = window.admin_mode || false; // –ê–¥–º–∏–Ω-—Ä–µ–∂–∏–º
        this.config = {};
        this.SlideMenu =  {};
        this.selectedIcon = null;
        this.points = new Map();
    }

    async initMap() {
        const init = await getInit();
        if (!init) return;

        this.mapName = init.map;
        const config = await getConfig(this.mapName);
        if (!config) return;
        this.config = config;
        this.lastUpdated = config.lastUpdated;
        this.initializeMap(config);
        this.createPolygons(config);
        this.setDrawButtonHandler();
        this.setReverseButtonHandler(config);
        this.setMapEventHandlers();
        this.initializeMarkerMenu();
        updateInfoBar(config);
        if (!this.admin_mode) setInterval(() => this.checkForConfigUpdates(), 1000);
    }

    initializeMap(config) {
        const image = `/static/images/${config.image}`;
        const { width, height, maxLevel, minLevel, orgLevel } = config;

        const tileWidth = 256 * Math.pow(2, orgLevel);
        const radius = tileWidth / 2 / Math.PI;
        const rx = width - tileWidth / 2;
        const ry = -height + tileWidth / 2;
        const west = -180;
        const east = (180 / Math.PI) * (rx / radius);
        const north = 85.05;
        const south = (360 / Math.PI) * (Math.atan(Math.exp(ry / radius)) - Math.PI / 4);
        const bounds = [[south, west], [north, east]];

        const mapOptions = {
            maxBounds: bounds,
              zoomControl: this.admin_mode,
            /*
            dragging: this.admin_mode,

            scrollWheelZoom: this.admin_mode,
            doubleClickZoom: this.admin_mode,
            touchZoom: this.admin_mode,
            keyboard: this.admin_mode,
             */
        };

        this.map = L.map('map', mapOptions);
        L.tileLayer(image + '/{z}-{x}-{y}.jpg', {
            maxZoom: maxLevel,
            minZoom: minLevel,
            noWrap: true,
            bounds: bounds,
            attribution: '<a href="https://github.com/oliverheilig/LeafletPano">LeafletPano</a>',
        }).addTo(this.map);

        this.map.setView([config.mapState.center.lat, config.mapState.center.lng], config.mapState.zoom);
    }

    createPolygons(config) {
        createPolygons.call(this,config)
    }

    createPolygonClickHandler(polygonLayer) {
        if (this.admin_mode) {
            return (e) => {
                if (e.originalEvent.ctrlKey) {
                    this.map.removeLayer(polygonLayer);
                    this.polygons = this.polygons.filter(p => p.layer !== polygonLayer);
                    this.sendPolygonsData();
                } else {
                    polygonLayer.isVisible = !polygonLayer.isVisible;
                    polygonLayer.setStyle({
                        fillOpacity: polygonLayer.isVisible ? 1.0 : 0.0,
                        opacity: polygonLayer.isVisible ? 1.0 : 0.0,
                    });
                    this.sendPolygonsData();
                }
            };
        }
    }

    sendPolygonsData() {
        sendPolygonsData.call(this);
    }

    setDrawButtonHandler() {
        const drawButton = document.getElementById('draw-button');
        if (!drawButton) return;

        drawButton.addEventListener('click', (e) => {
            e.preventDefault();
            this.drawingMode = !this.drawingMode;
            drawButton.textContent = this.drawingMode ? "Finish Drawing" : "Draw Polygon";

            if (this.drawingMode) {
                this.setPolygonsOpacity(0.6);
                this.setPolygonClickability(false);
            } else {
                this.setPolygonsOpacity(1.0);
                this.setPolygonClickability(true);

                if (this.polygonPoints.length > 2) {
                    this.createNewPolygon();
                    this.sendPolygonsData();
                }
            }
        });
    }

    setReverseButtonHandler(config) {
        const reverseButton = document.getElementById('reverse-button');
        if (!reverseButton) return;

        reverseButton.addEventListener('click', () => {
            if (this.mainPolygon) {
                this.updateMainPolygon(config);
                this.toggleMainPolygonVisibility();
            } else {
                this.createMainPolygon(config);
            }
        });
    }

    createNewPolygon() {
        const polygonLayer = L.polygon(this.polygonPoints, {
            color: 'black',
            fillColor: 'black',
            fillOpacity: 1.0,
            weight: 1,
        }).addTo(this.map);

        polygonLayer.isVisible = true;
        polygonLayer.clickHandler = this.createPolygonClickHandler(polygonLayer);
        polygonLayer.on('click', polygonLayer.clickHandler);

        this.polygons.push({
            layer: polygonLayer,
            points: this.polygonPoints,
            isVisible: polygonLayer.isVisible,
        });

        this.polygonMarkers.forEach(marker => this.map.removeLayer(marker));
        this.polygonMarkers = [];
        this.polygonPoints = [];
        this.markerCount = 0;
    }

    toggleMainPolygonVisibility() {
        toggleMainPolygonVisibility.call(this);
    }

    createMainPolygon(config) {
        createMainPolygon.call(this,config)
    }

    updateMainPolygon(config) {
        updateMainPolygon.call(this, config);
    }

    async checkForConfigUpdates() {
        await checkForConfigUpdates.call(this);
    }

    setPolygonsOpacity(opacity) {
        this.polygons.forEach(polygon => polygon.layer.setStyle({ fillOpacity: opacity, opacity: opacity }));
    }

    setPolygonClickability(clickable) {
        setPolygonClickability.call(this,clickable)
    }

    setMapEventHandlers() {
        this.map.on('zoomend', ()=>{
            this.sendPolygonsData();
        });

        this.map.on('movestart', ()=>{
            document.getElementById('map').style.opacity = '0';
        });
        this.map.on('moveend', ()=>{
            this.sendPolygonsData();
            document.getElementById('map').style.opacity = '1';

        });

        this.map.on('click', (e) => {
            if (this.drawingMode) {
                this.markerCount += 1;
                this.polygonPoints.push([e.latlng.lat, e.latlng.lng]);

                const marker = L.marker([e.latlng.lat, e.latlng.lng], { icon: createNumberedIcon(this.markerCount) }).addTo(this.map);
                this.polygonMarkers.push(marker);
            }
        });

        this.map.on('click', (e) => {
            if (this.selectedIcon) {
                // –†–∞–∑–º–µ—â–∞–µ–º –º–∞—Ä–∫–µ—Ä —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∏–∫–æ–Ω–∫–æ–π
                let id = new Date().getTime();
                const marker = L.marker(e.latlng, {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: `<div data-id>${this.selectedIcon.emoji}</div>`,
                    }),
                    draggable: true
                }).addTo(this.map);
                marker.bindPopup(`
                   <button onclick="window.mapManager.removeMarker(${id})">Remove</button>
                 `);

                this.points.set(id, marker);
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É
                this.selectedIcon = null;
                document.querySelector('.marker-menu').style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
                console.log(
                    Array.from(this.points)
                )
            }
        });

        this.map.whenReady(this.whenReady);

        let markerButton = document.getElementById('marker-button');
        if (markerButton) {
            markerButton.addEventListener('click', (e) => {
                const sidebar = document.querySelector('.marker-menu');
                sidebar.style.right = sidebar.style.right === '0px' ? '-33%' : '0px';
            })
        }

    }

    whenReady(){
        checkTab();
        this.SlideMenu =  new SlideMenu();
        this.SlideMenu.initializeMapMarkers(this.map);
    }

    removeMarker(index) {
        const marker = this.points.get(index);
        if (marker) {
            window.mapManager.map.removeLayer(marker);
            this.points.delete(index);
        }
    }

    updateInfoBar(data) {
        const infoBar = document.getElementById('info-bar');
        if (!infoBar) return;
        const round = data.init.round;
        const tryNumber = data.init.try; // –ü—Ä–∏–º–µ—Ä: —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥—Ä–æ–±–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const nextNumber = data.init.next; // –ü—Ä–∏–º–µ—Ä: —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥—Ä–æ–±–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const participants = data.init.all;

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ
        const sortedParticipants = participants.slice().sort((a, b) => b.init - a.init);

        // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –∏ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
        const currentIndex = sortedParticipants.findIndex(participant => participant.init.toString() === tryNumber.toString());
        const nextIndex = sortedParticipants.findIndex(participant => participant.init.toString() === nextNumber.toString());
        const current = sortedParticipants[currentIndex] || null;
        const next = sortedParticipants[nextIndex] || null;


        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
        infoBar.innerHTML = `
      –†–∞—É–Ω–¥: <span>${round}</span>,
      –•–æ–¥: ${current ? getParticipantHTML(current) : '---'},
      –°–ª–µ–¥—É—é—â–∏–π: ${next ? getParticipantHTML(next) : '---'}
    `;
    }

    initializeMarkerMenu() {
        const sidebar = document.createElement('div');
        sidebar.classList.add('marker-menu');
        this.menu = sidebar;
        const icons = [{ name: "–ß–µ–ª–æ–≤–µ—á–µ–∫", emoji: "üë§" },
            { name: "–î–µ—Ä–µ–≤–æ", emoji: "üå≥" },
            { name: "–ß–µ—Ä–µ–ø—É—à–∫–∞", emoji: "üíÄ" },];
        const list = document.createElement('ul');
        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∫–æ–Ω–∫–∏
        icons.forEach(icon => {
            const button = document.createElement('button');
            button.textContent = `${icon.emoji} ${icon.name}`;
            button.addEventListener('click', () => {
                this.selectedIcon = icon; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É
                sidebar.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
            });
            list.appendChild(button);
        });
        sidebar.appendChild(list);
        document.body.appendChild(sidebar);
    }

}

const mapManager = new MapManager();
window.mapManager = mapManager;
mapManager.initMap();


---------------–ö–æ–¥ static\js\skull.js:
    let flashingInterval;

    function updateSkullColor(color=3) {
        const skull = document.getElementById('skull');
        clearInterval(flashingInterval); // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
        function flashColors() {
            const colors = ['green', 'yellow', 'red', 'blue', 'purple'];
            let index = 0;

            flashingInterval = setInterval(() => {
                skull.style.color = colors[index];
                index = (index + 1) % colors.length;
            }, 500); // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∫–∞–∂–¥—ã–µ 500 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
        }
        switch (color) {
            case 0:
                skull.style.color = 'green';
                break;
            case 1:
                skull.style.color = 'yellow';
                break;
            case 2:
                skull.style.color = 'red';
                break;
            case 3:
                flashColors();
                break;
            default:
                skull.style.color = 'black'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }
    }



---------------–ö–æ–¥ static\js\tabs.js:
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
export function showTab(tabId) {
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
    document.querySelectorAll('.tab-content').forEach(function(tab) {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.tab-button').forEach(function(button) {
        button.classList.remove('active');
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    document.getElementById(tabId).classList.add('active');
    document.getElementById(tabId+'-controls')?.classList.add('active');
    location.hash = tabId
}

export function checkTab() {
    let tabId = window.location.hash.replace('#','');
    if (document.getElementById(tabId)){
        showTab(tabId);
    }
}

window.showTab = showTab;

---------------–ö–æ–¥ static\js\tests.js:
import {init} from "./test/init.js";
import {empty} from "./test/empty.js";
import {tab} from "./test/tab.js";
import {location} from "./test/location.js";
import {npc} from "./test/npc.js";
import {map} from "./test/map.js";
const sleeper = 200;

// –û–±—ä–µ–∫—Ç —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏
const tests = { empty, tab, init, location, npc, map};

export async function test(testing = 'all') {
    console.log("=== –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===");
    //await fetch('/api/test/start');
    if (testing === 'all') {
        await empty(sleeper);
        await tab(sleeper);
        await init(sleeper);
        await location(sleeper);
        await npc(sleeper);
    } else if (typeof tests[testing] === 'function') {
        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ –æ–±—ä–µ–∫—Ç–∞ tests
        await tests[testing](sleeper);
    } else {
        console.error(`Function "${testing}" does not exist.`);
    }
     console.info("=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ ===");
    //await fetch('/api/test/end');
}

window.test = test;

---------------–ö–æ–¥ static\js\textarea.js:
    const textarea = document.getElementById('dynamic-text');

    // –§—É–Ω–∫—Ü–∏—è debounce, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function debounce(func, delay) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout); // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            timeout = setTimeout(() => func.apply(this, args), delay); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
        };
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    function sendData() {
        const data = { text: textarea.value }; // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

        fetch('/api/config/dm', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => console.log('–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data))
        .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:', error));
    }

    // –°–æ–∑–¥–∞–µ–º –æ–±–µ—Ä—Ç–∫—É sendData —Å –¥–µ–±–∞—É–Ω—Å–æ–º –Ω–∞ 500 –º—Å
    const debouncedSendData = debounce(sendData, 500);

    // –í—ã–∑—ã–≤–∞–µ–º debouncedSendData –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏ 'input'
    textarea.addEventListener('input', debouncedSendData);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    function loadData() {
        fetch('/api/config/dm', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –∑–∞–ø–æ–ª–Ω—è–µ–º textarea
            textarea.value = data.join('\n');
        })
        .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error));
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadData();

---------------–ö–æ–¥ static\js\time.js:
class FaerunCalendar {
    constructor() {
        this.months = [
            {
                nameEn: "Hammer",
                nameRu: "–•–∞–º–º–µ—Ä (Hammer)",
                nicknameEn: "Deepwinter",
                nicknameRu: "–†–∞–∑–≥–∞—Ä –∑–∏–º—ã (Deepwinter)",
                days: 30
            },
            {
                nameEn: "Alturiak",
                nameRu: "–ê–ª—å—Ç—É—Ä–∏–∞–∫ (Alturiak)",
                nicknameEn: "The Claw of Winter",
                nicknameRu: "–ö–æ–≥–æ—Ç—å –∑–∏–º—ã (The Claw of Winter)",
                days: 30
            },
            {
                nameEn: "Ches",
                nameRu: "–ß–µ—Å (Ches)",
                nicknameEn: "of the Sunsets",
                nicknameRu: "–ú–µ—Å—è—Ü –∑–∞–∫–∞—Ç–æ–≤ (of the Sunsets)",
                days: 30
            },
            {
                nameEn: "Tarsakh",
                nameRu: "–¢–∞—Ä—Å–∞—Ö (Tarsakh)",
                nicknameEn: "of the Storms",
                nicknameRu: "–ú–µ—Å—è—Ü –≥—Ä–æ–∑ (of the Storms)",
                days: 30
            },
            {
                nameEn: "Mirtul",
                nameRu: "–ú–∏—Ä—Ç—É–ª (Mirtul)",
                nicknameEn: "The Melting",
                nicknameRu: "–ú–µ—Å—è—Ü —Ç–∞—è–Ω–∏—è —Å–Ω–µ–≥–æ–≤ (The Melting)",
                days: 30
            },
            {
                nameEn: "Kythorn",
                nameRu: "–ö–∏—Ç–æ—Ä–Ω (Kythorn)",
                nicknameEn: "The Time of Flowers",
                nicknameRu: "–í—Ä–µ–º—è —Ü–≤–µ—Ç–æ–≤ (The Time of Flowers)",
                days: 30
            },
            {
                nameEn: "Flamerule",
                nameRu: "–§–ª–µ–π–º—Ä—É–ª (Flamerule)",
                nicknameEn: "Summertide",
                nicknameRu: "–†–∞–∑–≥–∞—Ä –ª–µ—Ç–∞ (Summertide)",
                days: 30
            },
            {
                nameEn: "Elesias",
                nameRu: "–≠–ª–µ—Å–∏–∞—Å (Elesias)",
                nicknameEn: "Highsun",
                nicknameRu: "–°–æ–ª–Ω—Ü–µ –≤ –∑–µ–Ω–∏—Ç–µ (Highsun)",
                days: 30
            },
            {
                nameEn: "Eleint",
                nameRu: "–≠–ª–µ–π–Ω—Ç (Eleint)",
                nicknameEn: "The Fading",
                nicknameRu: "–£–≥–∞—Å–∞–Ω–∏–µ (The Fading)",
                days: 30
            },
            {
                nameEn: "Marpenoth",
                nameRu: "–ú–∞—Ä–ø–µ–Ω–æ—Ç (Marpenoth)",
                nicknameEn: "Leaffall",
                nicknameRu: "–õ–∏—Å—Ç–æ–ø–∞–¥ (Leaffall)",
                days: 30
            },
            {
                nameEn: "Uktar",
                nameRu: "–£–∫—Ç–∞—Ä (Uktar)",
                nicknameEn: "The Rotting",
                nicknameRu: "–£–º–∏—Ä–∞–Ω–∏–µ (The Rotting)",
                days: 30
            },
            {
                nameEn: "Nightal",
                nameRu: "–ù–∞–π—Ç–æ–ª (Nightal)",
                nicknameEn: "The Drawing Down",
                nicknameRu: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–æ–¥–∞ (The Drawing Down)",
                days: 30
            },
        ];

        this.specialDays = [
            { nameEn: "Midwinter", nameRu: "–ú–∞–∫—É—à–∫–∞ –∑–∏–º—ã (Midwinter)", dayOfYear: 31 },
            { nameEn: "Greengrass", nameRu: "–î–µ–Ω—å –ó–µ–ª–µ–Ω–æ–π —Ç—Ä–∞–≤—ã (Greengrass)", dayOfYear: 122 },
            { nameEn: "Midsummer", nameRu: "–°–æ–ª–Ω—Ü–µ–≤–æ—Ä–æ—Ç (Midsummer)", dayOfYear: 213 },
            { nameEn: "Shieldmeet", nameRu: "–î–µ–Ω—å –©–∏—Ç–æ–≤–æ–≥–æ —Å—Ö–æ–¥–∞ (Shieldmeet)", dayOfYear: 214 },
            { nameEn: "Highharvestide", nameRu: "–ü—Ä–∞–∑–¥–Ω–∏–∫ —É—Ä–æ–∂–∞—è (Highharvestide)", dayOfYear: 274 },
            { nameEn: "The Feast of the Moon", nameRu: "–ü–∏—Ä –õ—É–Ω—ã (The Feast of the Moon)", dayOfYear: 334 },
        ];

        this.daysInYear = 365;
        this.currentDayOfYear = 1;
        this.currentYear = 1372;
        this.format = "nameRu"; // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–≤–æ–¥–∞: nameRu, nameEn, nicknameRu, nicknameEn
    }

    setFormat(format) {
        const validFormats = ["nameRu", "nameEn", "nicknameRu", "nicknameEn"];
        if (!validFormats.includes(format)) {
            throw new Error("Invalid format. Choose one of: " + validFormats.join(", "));
        }
        this.format = format;
    }

    getCurrentDay() {
        return this.currentDayOfYear;
    }

    getCurrentYear() {
        return this.currentYear;
    }

    getCurrentMonth() {
        let remainingDays = this.currentDayOfYear;
        for (const month of this.months) {
            if (remainingDays <= month.days) {
                return month[this.format];
            }
            remainingDays -= month.days;
        }

        const specialDay = this.specialDays.find(day => day.dayOfYear === this.currentDayOfYear);
        if (specialDay) {
            return specialDay[this.format];
        }

        return null;
    }

    calculateDate(offset) {
        let newDayOfYear = (this.currentDayOfYear + offset) % this.daysInYear;
        if (newDayOfYear <= 0) newDayOfYear += this.daysInYear;

        let newYear = this.currentYear + Math.floor((this.currentDayOfYear + offset) / this.daysInYear);
        return this.getDateFromDayOfYear(newDayOfYear, newYear);
    }

    getDateInFuture(days) {
        return this.calculateDate(days);
    }

    getDateInPast(days) {
        return this.calculateDate(-days);
    }

    getDateFromDayOfYear(dayOfYear, year) {
        let remainingDays = dayOfYear;
        for (const month of this.months) {
            if (remainingDays <= month.days) {
                return { day: remainingDays, month: month[this.format], year };
            }
            remainingDays -= month.days;
        }

        const specialDay = this.specialDays.find(day => day.dayOfYear === dayOfYear);
        if (specialDay) {
            return { day: specialDay[this.format], month: null, year };
        }

        return null;
    }

    setCurrentDate(dayOfYear, year) {
        if (dayOfYear < 1 || dayOfYear > this.daysInYear) {
            throw new Error("Invalid day of the year.");
        }
        this.currentDayOfYear = dayOfYear;
        this.currentYear = year;
    }
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
const faerunCalendar = new FaerunCalendar();
faerunCalendar.setCurrentDate(45, 1372); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 45-–π –¥–µ–Ω—å 1372 –≥–æ–¥–∞
faerunCalendar.setFormat("nameRu"); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ –Ω–∞ —Ä—É—Å—Å–∫–∏–π (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)

console.log(faerunCalendar.getCurrentDay()); // –¢–µ–∫—É—â–∏–π –¥–µ–Ω—å
console.log(faerunCalendar.getCurrentMonth()); // –¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
console.log(faerunCalendar.getDateInFuture(50)); // –î–∞—Ç–∞ —á–µ—Ä–µ–∑ 50 –¥–Ω–µ–π
console.log(faerunCalendar.getDateInPast(30)); // –î–∞—Ç–∞ 30 –¥–Ω–µ–π –Ω–∞–∑–∞–¥

---------------–ö–æ–¥ static\js\timer.js:
function startCountdown(endTime) {
  const startTime = new Date().getTime();
  const countdownMinutes = 5; // –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞–π–º–µ—Ä–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö
  endTime = endTime * 1000;

  const canvas = document.getElementById('timerCanvas');
  const ctx = canvas.getContext('2d');
  const timerText = document.getElementById('timerText');

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Canvas
  canvas.width = 75;
  canvas.height = 75;
  const radius = canvas.width / 2 - 10;
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –æ–¥–∏–Ω —Ä–∞–∑
  timerText.style.display = 'block';

  function updateTimer() {
    const now = new Date().getTime();
    const remainingTime = Math.max(0, endTime - now);
    const totalSeconds = Math.floor(remainingTime / 1000);

    // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Ç–∞–π–º–µ—Ä–∞
    const percent = remainingTime / (endTime - startTime);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ç–∞–π–º–µ—Ä–∞
    timerText.innerHTML = `${totalSeconds.toString().padStart(2, '0')}`;

    // –û—á–∏—â–∞–µ–º –∏ —Ä–∏—Å—É–µ–º –∫—Ä—É–≥–æ–≤–æ–π —Ç–∞–π–º–µ—Ä
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.arc(
      centerX,
      centerY,
      radius,
      -Math.PI / 2,
      -Math.PI / 2 - 2 * Math.PI * percent,
      true
    );
    ctx.lineWidth = 8;
    ctx.strokeStyle = 'blue';
    ctx.stroke();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
    if (remainingTime > 0) {
      requestAnimationFrame(updateTimer);
    } else {
      timerText.style.display = 'none';
    }
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
  updateTimer();
}


---------------–ö–æ–¥ static\js\api\npc.js:
export class NpcApi {
    constructor() {}

    async getNpc(query='') {
        const response = await fetch(`/api/data/npc?name=${encodeURIComponent(query)}`);
        return await response.json();
    }
}

---------------–ö–æ–¥ static\js\init\api.js:
export async function loadInitiativeData() {
    fetch("/api/config/init")
        .then(response => {
            if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
            return response.json();
        })
        .then(data => {
            this.currentRound = data.round || 0;
            this.currentCharacterIndex = data.try || 0;
            this.charactersData = data.all || [];
            this.displayInfoBlocks();
            this.displayCharacters();
        })
        .catch(error => console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:", error));
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
export  function  sendInit() {
    const dataToSend = {
        round: this.currentRound,
        try: this.currentCharacterIndex,
        all: this.charactersData,
        rating: this.rating,
        next: this.nextCharacterIndex
    };
    fetch("/api/config/init", {
        method: "POST",
        headers: { "Content-Type": "application/json;charset=UTF-8" },
        body: JSON.stringify(dataToSend)
    }).catch(error => console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:", error));
}
export async function infoCharacter(name) {
    // –ü–æ–∏—Å–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
    const response = await fetch(`/api/data/monsters/html?name=${encodeURIComponent(name)}`);
    const text = await response.text();

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ø–∞–ø–∞
    const popup = document.createElement('div');
    popup.className = 'popup-overlay';

    popup.innerHTML = `
        <div class="popup-content">
            <div class="popup-text">${text}</div>
            <button class="popup-close-btn">OK</button>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ø–∞–ø –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    document.body.appendChild(popup);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
    popup.querySelector('.popup-close-btn').addEventListener('click', () => {
        document.body.removeChild(popup);
    });
}


---------------–ö–æ–¥ static\js\init\display.js:

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
export function displayInfoBlocks() {
    document.getElementById('current-round').textContent = this.currentRound;
    document.getElementById('battle-rating').textContent = this.rating;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ
export function displayCurrentAndNextTurn(initData) {
    const characters = initData.charactersData.sort((a, b) => parseFloat(b.init) - parseFloat(a.init));

    const currentCharacter = characters.find(character => parseFloat(character.init) == initData.currentCharacterIndex);
    const nextCharacter = characters.find(character => parseFloat(character.init) < initData.currentCharacterIndex) || characters[0];
    initData.nextCharacterIndex = nextCharacter.init;
    document.getElementById('current-round').textContent = initData.currentRound;
    if (currentCharacter) document.getElementById('current-turn').textContent = currentCharacter.name;
    if (nextCharacter) document.getElementById('next-turn').textContent = nextCharacter.name;
}

export function  fillEditForm(data) {
        const form = document.getElementById('add-character-form');
        form.style.display = 'grid'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.getElementById('new-init').value = data.init || '';
        document.getElementById('new-name').value = data.name || '';
        document.getElementById('new-cd').value = data.armor_class || '10';
        document.getElementById('new-hp-now').value = data.hit_points || '';
        document.getElementById('new-hp-max').value = data.hit_points || '';
        document.getElementById('new-npc').checked = 'true';
        document.getElementById('new-experience').value = data.challenge_rating || '1';
    }

---------------–ö–æ–¥ static\js\init\func.js:
export function calculateEncounterData(characters) {
    const ENCOUNTER_EASY = 0,
          ENCOUNTER_MEDIUM = 1,
          ENCOUNTER_HARD = 2,
          ENCOUNTER_DEADLY = 3;

    const xpThresholdsByLevel = {
        1: [25, 50, 75, 100],
        2: [50, 100, 150, 200],
        3: [75, 150, 225, 400],
        4: [125, 250, 375, 500],
        5: [250, 500, 750, 1100],
        6: [300, 600, 900, 1400],
        7: [350, 750, 1100, 1700],
        8: [450, 900, 1400, 2100],
        9: [550, 1100, 1600, 2400],
        10: [600, 1200, 1900, 2800],
        11: [800, 1600, 2400, 3600],
        12: [1000, 2000, 3000, 4500],
        13: [1100, 2200, 3400, 5100],
        14: [1250, 2500, 3800, 5700],
        15: [1400, 2800, 4300, 6400],
        16: [1600, 3200, 4800, 7200],
        17: [2000, 3900, 5900, 8800],
        18: [2100, 4200, 6300, 9500],
        19: [2400, 4900, 7300, 10900],
        20: [2800, 5700, 8500, 12700]
    };

    const danger = {
        "0": 10,
        "1/8": 25, "1/4": 50, "1/2": 100,
        "0.125": 25, "0.25": 50, "0.5": 100,
        "1": 200, "2": 450, "3": 700, "4": 1100,
        "5": 1800, "6": 2300, "7": 2900, "8": 3900, "9": 5000, "10": 5900, "11": 7200,
        "12": 8400, "13": 10000, "14": 11500, "15": 13000, "16": 15000, "17": 18000,
        "18": 20000, "19": 22000, "20": 25000, "21": 33000, "22": 41000, "23": 50000,
        "24": 62000, "25": 75000, "26": 90000, "27": 105000, "28": 120000, "29": 135000,
        "30": 155000
    };

    // –ú–∞—Å—Å–∏–≤ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—Ä–∞–≥–æ–≤
    const factor = [1, 1.5, 2, 2.5, 3, 4];

    let playerTotal = 0;
    let masterTotal = 0;
    let totalExp = 0;
    let difficultyThresholds = [0, 0, 0, 0];
    let encounterDifficulty = 0;

    // 1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ—Ä–æ–≥–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã
    characters.forEach(character => {
        const isNpc = character.npc === "true";
        const levelOrDanger = parseInt(character.exp);

        if (isNpc) {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ä–∞–≥–æ–≤ –∏ —Å—É–º–º–∞—Ä–Ω—ã–π –æ–ø—ã—Ç –≤—Ä–∞–≥–æ–≤
            masterTotal += 1;
            totalExp += danger[levelOrDanger] || 0;
        } else {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç—Ä—è–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞
            playerTotal += 1;
            if (xpThresholdsByLevel[levelOrDanger]) {
                difficultyThresholds[ENCOUNTER_EASY] += xpThresholdsByLevel[levelOrDanger][ENCOUNTER_EASY];
                difficultyThresholds[ENCOUNTER_MEDIUM] += xpThresholdsByLevel[levelOrDanger][ENCOUNTER_MEDIUM];
                difficultyThresholds[ENCOUNTER_HARD] += xpThresholdsByLevel[levelOrDanger][ENCOUNTER_HARD];
                difficultyThresholds[ENCOUNTER_DEADLY] += xpThresholdsByLevel[levelOrDanger][ENCOUNTER_DEADLY];
            }
        }
    });

    // 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
    let factorId;
    if (masterTotal === 1) {
        factorId = 1;
    } else if (masterTotal === 2) {
        factorId = 1.5;
    } else if (masterTotal >= 3 && masterTotal <= 6) {
        factorId = 2;
    } else if (masterTotal >= 7 && masterTotal <= 10) {
        factorId = 2.5;
    } else if (masterTotal >= 11 && masterTotal <= 14) {
        factorId = 3;
    } else {
        factorId = 4;
    }

    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –º–∞–ª—ã—Ö –∏–ª–∏ –±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø
    if (playerTotal < 3) {
        factorId = Math.min(factorId + 1, 4); // –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    } else if (playerTotal >= 6) {
        factorId = Math.max(factorId - 1, 0.5); // –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    }

    // 3. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –æ–ø—ã—Ç —Å —É—á–µ—Ç–æ–º –º–Ω–æ–∂–∏—Ç–µ–ª—è
    const adjustedExp = totalExp * factorId;

    // 4. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É–º–º–∞—Ä–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –≤—Ä–∞–≥–æ–≤
    if (adjustedExp <= difficultyThresholds[ENCOUNTER_EASY]) {
        encounterDifficulty = ENCOUNTER_EASY;
    } else if (adjustedExp <= difficultyThresholds[ENCOUNTER_MEDIUM]) {
        encounterDifficulty = ENCOUNTER_MEDIUM;
    } else if (adjustedExp <= difficultyThresholds[ENCOUNTER_HARD]) {
        encounterDifficulty = ENCOUNTER_HARD;
    } else {
        encounterDifficulty = ENCOUNTER_DEADLY;
    }

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ—Ä–æ–≥–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –∏—Ç–æ–≥–æ–≤—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å, —Å—É–º–º–∞—Ä–Ω—ã–π –æ–ø—ã—Ç –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
    return {
        difficultyThresholds,
        encounterDifficulty,
        adjustedExp,
        factorId
    };
}


export function debounce(func, delay) {
    let timeoutId;
    return function (...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
}

export function createEditableSpan(content, property, index, callback, after='') {
    // –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –ª–µ–π–±–ª –∏ –∑–Ω–∞—á–µ–Ω–∏–µ
    const [label, value] = content.split(': ');

    // –°–æ–∑–¥–∞–µ–º span –¥–ª—è –ª–µ–π–±–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º
    const labelSpan = document.createElement('span');
    labelSpan.textContent = `${label}: `;

    // –°–æ–∑–¥–∞–µ–º span –¥–ª—è –ª–µ–π–±–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º
    const afterSpan = document.createElement('span');
    afterSpan.textContent = after;

    // –°–æ–∑–¥–∞–µ–º span –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º
    const valueSpan = document.createElement('span');
    valueSpan.textContent = value;
    valueSpan.classList.add('editable-value');
    valueSpan.classList.add(property);
    valueSpan.onclick = () => {
        const newValue = window.prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è ${property}:`, valueSpan.textContent);
        if (newValue !== null) {
            valueSpan.textContent = newValue;
            callback(index, property, newValue);
        }
    };

    // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –ª–µ–π–±–ª –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    const containerSpan = document.createElement('span');
    containerSpan.append(labelSpan, valueSpan, afterSpan);

    return containerSpan;
}


---------------–ö–æ–¥ static\js\locations\api.js:
export async function loadMainLocations() {
    try {
        const response = await fetch(`${this.apiUrl}?type=main`);
        const data = await response.json();
        if (data && Array.isArray(data)) {
            this.mainLocationSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–∫–∞—Ü–∏—é</option>';
            data.forEach(location => {
                const option = document.createElement('option');
                option.value = location.ID;
                option.selected = location.active===1
                option.textContent = location.name;
                this.mainLocationSelect.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π:', error);
    }
}

export async function loadSubLocations() {
    const mainLocationId = this.mainLocationSelect.value;
    if (!mainLocationId) {
        this.subLocationList.innerHTML = '<li>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–∫–∞—Ü–∏—é.</li>';
        return;
    }
    try {
        const response = await fetch(`${this.apiUrl}?parent_id=${mainLocationId}&active=true`);
        const data = await response.json();
        this.subLocationList.innerHTML = ''; // –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
        if (data && Array.isArray(data) && data.length > 0) {
            data.forEach(location => {
                const listItem = document.createElement('li');

                // –ü–µ—Ä–≤—ã–π span: –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
                const nameSpan = document.createElement('span');
                nameSpan.textContent = location.name;
                nameSpan.classList.add('location-span');
                nameSpan.addEventListener('click', () => this.showEditPopup(location));

                // –í—Ç–æ—Ä–æ–π span: –∏–∫–æ–Ω–∫–∞ –∫—Ä–µ—Å—Ç–∏–∫–∞
                const removeSpan = document.createElement('span');
                removeSpan.classList.add('location-remove');
                removeSpan.textContent = '‚úñ'; // –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ª—é–±—É—é –∏–∫–æ–Ω–∫—É

                removeSpan.addEventListener('click', () => this.removeLocation(location.ID));

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–∞ span –≤ li
                listItem.appendChild(nameSpan);
                listItem.appendChild(removeSpan);

                // –î–æ–±–∞–≤–ª—è–µ–º ID –ª–æ–∫–∞—Ü–∏–∏ –≤ dataset li
                listItem.dataset.locationId = location.ID;

                // –î–æ–±–∞–≤–ª—è–µ–º li –≤ —Å–ø–∏—Å–æ–∫
                this.subLocationList.appendChild(listItem);
            });
        } else {
            this.subLocationList.innerHTML = '<li>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ª–æ–∫–∞—Ü–∏–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏.</li>';
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ª–æ–∫–∞—Ü–∏–π:', error);
    }
}

---------------–ö–æ–¥ static\js\locations\helpers.js:


---------------–ö–æ–¥ static\js\script\api.js:

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
import {setAudio, updateInfoBar} from "./helpers.js";

export async function getInit() {
  const response = await fetch('/api/config');
  if (response.ok) {
    return response.json();
  } else {
    console.error("Error fetching initial config");
    return null;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã –ø–æ –∏–º–µ–Ω–∏
export async function getConfig(mapName) {
  const response = await fetch(`/api/configs/${mapName}`);
  if (response.ok) {
    return response.json();
  } else {
    console.error(`Error fetching map config for ${mapName}`);
    return null;
  }
}

  export function sendPolygonsData() {
    if (!this.admin_mode) return;

    const polygonsData = this.polygons.map(polygon => ({
      points: polygon.points,
      isVisible: polygon.layer.isVisible,
    }));

    const center = this.map.getCenter();
    const zoomLevel = this.map.getZoom();

    fetch('/api/polygons', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        mapName: this.mapName,
        polygons: polygonsData,
        mainPolygon: this.mainPolygon ? { points: this.mainPolygon.getLatLngs() } : null,
        mapState: {
          center: { lat: center.lat, lng: center.lng },
          zoom: zoomLevel,
        },
      }),
    })
      .then(response => response.json())
      .then(data => console.log("Data sent successfully:", data))
      .catch(error => console.error("Error sending polygons data:", error));
  }

  export async function checkForConfigUpdates() {
    const config = await getConfig(this.mapName);


    if (config && config.lastUpdated !== this.lastUpdated) {
      this.lastUpdated = config.lastUpdated;
      this.createPolygons(config);
      setAudio(config);
      startCountdown(config.timer);
      updateSkullColor(config.init.rating);
      updateInfoBar(config);
      this.map.setView([config.mapState.center.lat, config.mapState.center.lng], config.mapState.zoom);
      console.log("Map data updated due to configuration change.");
    }
  }

---------------–ö–æ–¥ static\js\script\helpers.js:
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
export function createNumberedIcon(number) {
  return L.divIcon({
    className: 'numbered-icon',
    iconSize: [10, 10],
    html: `<div style="display: flex; align-items: center;">
             <div style="min-width: 6px; height: 6px; background-color: red; border-radius: 50%;"></div>
             <span style="color:red; margin-left: 5px; font-size: 10px;">${number}</span>
           </div>`
  });
}

export function setAudio(config) {
  const audio = document.getElementById('audio');
  let src = '/static/audio/'+config.ambience+'.mp3';
  if (audio.src.indexOf(src)==-1) {
    audio.src = src;
    audio.play();
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ü–≤–µ—Ç–∞ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é
export function getHealthColor(hpNow, hpMax) {
    const ratio = hpNow / hpMax;

    if (ratio > 1 ) {
        // –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∑–µ–ª–µ–Ω–æ–≥–æ –∫ —Å–∏–Ω–µ–º—É
        const blueRatio = (ratio - 1) * 2; // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1]
        const g = Math.round(255 * (1 - blueRatio));
        const b = Math.round(255 * blueRatio);
        return `rgb(0, ${g}, ${b})`;
    } else if (ratio >= 0.5) {
        // –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∂–µ–ª—Ç–æ–≥–æ –∫ –∑–µ–ª–µ–Ω–æ–º—É
        const greenRatio = (ratio - 0.5) * 2; // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1]
        const r = Math.round(255 * (1 - greenRatio));
        const g = 255;
        return `rgb(${r}, ${g}, 0)`;
    } else if (ratio > 0) {
        // –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ –∫ –∂–µ–ª—Ç–æ–º—É
        const redRatio = ratio * 2; // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 1]
        const r = 255;
        const g = Math.round(255 * redRatio);
        return `rgb(${r}, ${g}, 0)`;
    } else {
        // –ï—Å–ª–∏ ratio <= 0, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫—Ä–∞—Å–Ω—ã–π
        return `rgb(255, 0, 0)`;
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
export function getParticipantHTML(participant) {
    const { name, hp_now, hp_max } = participant;
    const color = getHealthColor(hp_now, hp_max);
    return `<span style="color: ${color};">${name}</span>`;
}

export function setDrawButtonHandler() {
    const drawButton = document.getElementById('draw-button');
    if (!drawButton) return;
    drawButton.addEventListener('click', (e) => {
        e.preventDefault();
        this.drawingMode = !this.drawingMode;
        drawButton.textContent = this.drawingMode ? "Finish Drawing" : "Draw Polygon";
        if (this.drawingMode) {
            this.setPolygonsOpacity(0.6);
            this.setPolygonClickability(false);
        } else {
            this.setPolygonsOpacity(1.0);
            this.setPolygonClickability(true);
            if (this.polygonPoints.length > 2) {
                this.createNewPolygon();
                this.sendPolygonsData();
            }
        }
    });
}

 export function updateInfoBar(data) {
        const infoBar = document.getElementById('info-bar');
        if (!infoBar) return;
        const round = data.init.round;
        const tryNumber = data.init.try; // –ü—Ä–∏–º–µ—Ä: —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥—Ä–æ–±–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const nextNumber = data.init.next; // –ü—Ä–∏–º–µ—Ä: —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥—Ä–æ–±–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        const participants = data.init.all;

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ
        const sortedParticipants = participants.slice().sort((a, b) => b.init - a.init);

        // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –∏ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
        const currentIndex = sortedParticipants.findIndex(participant => participant.init.toString() === tryNumber.toString());
        const nextIndex = sortedParticipants.findIndex(participant => participant.init.toString() === nextNumber.toString());
        const current = sortedParticipants[currentIndex] || null;
        const next = sortedParticipants[nextIndex] || null;


        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
        infoBar.innerHTML = `
      –†–∞—É–Ω–¥: <span>${round}</span>,
      –•–æ–¥: ${current ? getParticipantHTML(current) : '---'},
      –°–ª–µ–¥—É—é—â–∏–π: ${next ? getParticipantHTML(next) : '---'}
    `;
    }

---------------–ö–æ–¥ static\js\script\makrer.js:
export function initializeMarkers(){
    let config = this.config;
    let map = this.map;
}

export class SlideMenu {
    constructor(mapManager) {
        this.mapManager = mapManager;
        this.markers = [];
    }
    toggle() {
        const sidebar = document.createElement('div');
        sidebar.style.right = sidebar.style.right === '0px' ? '-33%' : '0px';
    }

    initializeMapMarkers(map) {

    }

    startAdding(type) {
        this.toggle();
        window.mapManager.map.once('click', e => {
            const marker = L.marker(e.latlng, { draggable: type === 'draggable' }).addTo(window.mapManager.map);
            marker.bindPopup(`
           ${type} marker
           <button onclick="window.SlideMenu.removeMarker(${this.markers.length})">Remove</button>
         `);
            this.markers.push(marker);
        });
    }
    removeMarker(index) {
        const marker = this.markers[index];
        if (marker) {
            window.mapManager.map.removeLayer(marker);
            this.markers.splice(index, 1);
        }
    }
}

window.SlideMenu =  new SlideMenu();

---------------–ö–æ–¥ static\js\script\poligons.js:

export function  createPolygons(config) {
    this.polygons.forEach(polygon => this.map.removeLayer(polygon.layer));
    this.polygons = [];
    config.polygons.forEach(polygonData => {
        const polygonLayer = L.polygon(polygonData.points, {
            color: 'black',
            fillColor: 'black',
            fillOpacity: polygonData.isVisible ? 1.0 : 0.0,
            opacity: polygonData.isVisible ? 1.0 : 0.0,
            weight: 1,
        }).addTo(this.map);
        polygonLayer.isVisible = polygonData.isVisible;
        polygonLayer.clickHandler = this.createPolygonClickHandler(polygonLayer);
        polygonLayer.on('click', polygonLayer.clickHandler);
        this.polygons.push({
            layer: polygonLayer,
            points: polygonData.points,
            isVisible: polygonLayer.isVisible,
        });
    });
    if (config.mainPolygon) {
        if (this.mainPolygon) this.map.removeLayer(this.mainPolygon);
        this.mainPolygon = L.polygon(config.mainPolygon.points, {
            color: 'black',
            fillColor: 'black',
            fillOpacity: 1.0,
            weight: 3,
        }).addTo(this.map);
    }
}

export function toggleMainPolygonVisibility() {
    if (this.map.hasLayer(this.mainPolygon)) {
        this.map.removeLayer(this.mainPolygon);
    } else {
        this.mainPolygon.addTo(this.map);
    }
}
export function createMainPolygon(config) {
    const bounds = this.map.getBounds();
    const polygonPoints = [
        [bounds.getSouthWest().lat, bounds.getSouthWest().lng],
        [bounds.getSouthWest().lat, bounds.getNorthEast().lng],
        [bounds.getNorthEast().lat, bounds.getNorthEast().lng],
        [bounds.getNorthEast().lat, bounds.getSouthWest().lng],
    ];
    let holes = [];
    config.polygons.forEach(polygonData => {
        holes.push(polygonData.points);
    });
    this.mainPolygon = L.polygon([polygonPoints, holes], {
        color: 'black',
        fillColor: 'black',
        fillOpacity: 1,
        weight: 3,
    }).addTo(this.map);
}

export function updateMainPolygon(config) {
    let holes = [];
    config.polygons.forEach(polygonData => {
        holes.push(polygonData.points);
    });
    this.mainPolygon.setLatLngs([this.mainPolygon.getLatLngs()[0], holes]);
}

export function setPolygonClickability(clickable) {
    this.polygons.forEach(polygon => {
        if (clickable) {
            polygon.layer.on('click', polygon.layer.clickHandler);
        } else {
            polygon.layer.off('click', polygon.layer.clickHandler);
        }
    });
}



---------------–ö–æ–¥ static\js\test\empty.js:
import {exit, sleep} from './func.js'
import {showTab} from '../tabs.js'

export async function empty(sleeper) {

    //–¢–µ—Å—Ç
    console.log("=== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ NPC –≤ –ª–æ–∫–∞—Ü–∏—é ===");
    await sleep(sleeper);
    await (async () => {
        if(1){
            console.log("‚úì –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è");
        }
    })();


}




---------------–ö–æ–¥ static\js\test\func.js:
export function exit(text){
    console.error(text);
    die();
}

export function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

---------------–ö–æ–¥ static\js\test\init.js:
import {exit, sleep} from './func.js'
import {showTab} from '../tabs.js'

export async function init(sleeper) {
    let manager = initiativeManager;


    showTab('initiative-tab')
    await sleep(sleeper);
    //–ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
    console.log("=== –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ===");
    await (async () => {
        await manager.loadInitiativeData()
        if(manager.charactersData.length){
            console.log("‚úì –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö");
        }
    })();

    console.log("=== –ö–ª–∏–∫ –≤–ø–µ—Ä–µ–¥ ===");
    await sleep(sleeper);
    await (async () => {
        const oldData = (manager)=>{
            return {currentCharacterIndex,nextCharacterIndex } = manager
        }
        document.querySelector('.toggle-form-button.next').click();
        await sleep(sleeper);
        const newData = (manager)=>{
            return {currentCharacterIndex,nextCharacterIndex } = manager
        }
        if (oldData.currentCharacterIndex !== newData.currentCharacterIndex || oldData.nextCharacterIndex === newData.currentCharacterIndex) {
            console.log("‚úì –ö–Ω–æ–ø–∫–∞ Next —Ä–∞–±–æ—Ç–∞–µ—Ç");
        } else {
            exit("‚úó –ö–Ω–æ–ø–∫–∞ Next –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç",newData,oldData);
        }
    })();


    console.log("=== –ö–ª–∏–∫ –Ω–∞–∑–∞–¥ ===");
    await sleep(sleeper);
     await (async () => {
         const oldIndex = manager.currentCharacterIndex;
         document.querySelector('.toggle-form-button.prev').click();
         await sleep(sleeper);
         const newIndex = manager.currentCharacterIndex;
         if (oldIndex !== newIndex) {
             console.log("‚úì –ö–Ω–æ–ø–∫–∞ Prev —Ä–∞–±–æ—Ç–∞–µ—Ç");
         } else {
             exit("‚úó –ö–Ω–æ–ø–∫–∞ Prev –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         }
     })();

     console.log("=== –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===");
     await sleep(sleeper);
     await (async () => {
         let count = initiativeManager.charactersData.length;
         const addCharacter = document.querySelector(".toggle-form-button.add");
         addCharacter.click();

         document.getElementById('new-init').value = '30';//—Å —Å–∞–º–æ–π –±–æ–ª—å—à–æ–π –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–æ–π —á—Ç–æ–±—ã –±—ã–ª –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É
         document.getElementById('new-name').value = '–ü–µ—Ä—Å–æ–Ω–∞–∂ –¥–ª—è –¢–µ—Å—Ç–∞';
         document.getElementById('new-cd').value = '15';
         document.getElementById('new-hp-now').value = 20;
         document.getElementById('new-hp-max').value = 30;
         document.getElementById('new-surprise').checked = true;
         document.getElementById('new-npc').checked = true;
         document.getElementById('new-experience').value = '20';

         const saveCharacter = document.getElementById("add-character-button");
         saveCharacter.click();
         await sleep(sleeper);
         const count2 = initiativeManager.charactersData.length;
         if (count !== count2) {
             console.log("‚úì –ö–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         } else {
             exit("‚úó –ö–Ω–æ–ø–∫–∞ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         }

     })();


    console.log("=== –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–¥–æ—Ä–æ–≤—å–µ) ===");
    await sleep(sleeper);
     await (async () => {
         let tempPrompt = window.prompt;
         let newName = "1";
         window.prompt = () => newName;

         const firstCharacterNameSpan = document.querySelector('.editable-value.hp_now');
         firstCharacterNameSpan.click();
         await sleep(sleeper);

         if (manager.charactersData[0].hp_now === newName) {
             console.log("‚úì –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         } else {
             exit("‚úó –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         }

         window.prompt = tempPrompt; // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
     })();

     console.log("=== –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===");
     await sleep(sleeper);
     await (async () => {
         const current = manager.charactersData.find(c => c.init.toString() === manager.currentCharacterIndex);
         if (current) {
             console.log("‚úì –¢–µ–∫—É—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω");
         } else {
             exit("‚úó –û—à–∏–±–∫–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞");
         }
     })();

     console.log("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è ===");
     await sleep(sleeper);
     await (async () => {
         const testCharacter = manager.charactersData[0];
         testCharacter.hp_now = 1; // –£–º—ã—à–ª–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
         manager.healCharacter(0);
         await sleep(sleeper);

         if (testCharacter.hp_now === testCharacter.hp_max) {
             console.log("‚úì –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è —Ä–∞–±–æ—Ç–∞–µ—Ç");
         } else {
             exit("‚úó –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         }


         console.log("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===");
         await sleep(sleeper);
         const initialLength = manager.charactersData.length;
         manager.deleteCharacter(0);
         await sleep(sleeper);

         if (manager.charactersData.length === initialLength - 1) {
             console.log("‚úì –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         } else {
             exit("‚úó –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç");
         }
     })();
     await sleep(sleeper);

     console.log("=== –ü–æ–∏—Å–∫ –º–æ–Ω—Å—Ç—Ä–∞ –∏ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º—É ===");
     await (async () => {
         // –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç—Ä–æ–∫—É –ø–æ–∏—Å–∫–∞
         const npcInput = document.getElementById('npc-input');
         const npcList = document.getElementById('npc-list');
         // –®–∞–≥ 2: –í–≤–æ–¥–∏–º –∏–º—è –º–æ–Ω—Å—Ç—Ä–∞ –≤ —Å—Ç—Ä–æ–∫—É –ø–æ–∏—Å–∫–∞
         npcInput.value = "–ì–æ–±–ª–∏–Ω";
         npcInput.dispatchEvent(new Event('input'));
         // –û–∂–∏–¥–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–æ–Ω—Å—Ç—Ä–æ–≤ –ø–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞
         await sleep(300 + sleeper);
         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –º–æ–Ω—Å—Ç—Ä–æ–≤ –æ–±–Ω–æ–≤–∏–ª—Å—è –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
         if (npcList.innerHTML.trim().length > 0) {
             console.log("‚úì –°–ø–∏—Å–æ–∫ –º–æ–Ω—Å—Ç—Ä–æ–≤ –æ–±–Ω–æ–≤–∏–ª—Å—è");
             // –®–∞–≥ 3: –ö–ª–∏–∫ –ø–æ –ø–µ—Ä–≤–æ–º—É –Ω–∞–π–¥–µ–Ω–Ω–æ–º—É –º–æ–Ω—Å—Ç—Ä—É
             const firstNpc = npcList.querySelector('li');
             if (firstNpc) {
                 firstNpc.click();
                 await sleep(sleeper);
                 // –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä–∞ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏—Å—å –≤ —Ñ–æ—Ä–º—É
                 const nameInput = document.getElementById('new-name');
                 const cdInput = document.getElementById('new-cd');
                 const hpNowInput = document.getElementById('new-hp-now');
                 const hpMaxInput = document.getElementById('new-hp-max');
                 const expInput = document.getElementById('new-experience');
                 const newInit = document.getElementById('new-init');
                 if (nameInput.value) {
                     console.log("‚úì –î–∞–Ω–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä–∞ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏—Å—å –≤ —Ñ–æ—Ä–º—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ");

                     newInit.value = 40;
                     document.getElementById('add-character-button').click();
                     await sleep(sleeper);
                     const firstNpcInfo = document.querySelector('.character-row.character-npc .js-info');
                     firstNpcInfo.click();
                     await sleep(sleeper);
                     if (document.querySelector('.popup-overlay') && document.querySelector('.card__article-body')) {
                          console.log("‚úì –ü–æ–ø–∞–ø –æ—Ç–æ–±—Ä–∞–∑–∏–ª—Å—è");

                          await sleep(sleeper);
                          const closeButton = document.querySelector('.popup-close-btn');
                          closeButton.click();
                          await sleep(sleeper);
                          if (!document.querySelector('.popup-overlay')){
                              console.log("‚úì –ü–æ–ø–∞–ø –ó–∞–∫—Ä—ã–ª—Å—è");
                              manager.deleteCharacter(0);
                              await sleep(sleeper);
                          } else {
                              exit("‚úó –ü–æ–ø–∞–ø –Ω–µ –∑–∞–∫—Ä—ã–ª—Å—è");
                          }
                     } else {
                          exit("‚úó –ü–æ–ø–∞–ø –Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏–ª—Å—è");
                     }
                 } else {
                     exit("‚úó –î–∞–Ω–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä–∞ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏—Å—å –≤ —Ñ–æ—Ä–º—É");
                 }
             } else {
                 exit("‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –º–æ–Ω—Å—Ç—Ä–∞ –≤ —Å–ø–∏—Å–∫–µ");
             }
         } else {
             exit("‚úó –°–ø–∏—Å–æ–∫ –º–æ–Ω—Å—Ç—Ä–æ–≤ –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è");
         }
     })();

     await sleep(sleeper);
}


window.test = init;

---------------–ö–æ–¥ static\js\test\location.js:
import { exit, sleep } from './func.js';
import {showTab} from '../tabs.js'

export async function location(sleeper) {
    const manager = window.LocationManager;

    showTab('monster-tab')
    await sleep(sleeper);
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π
    console.log("=== –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π ===");
    await (async () => {
        await manager.loadMainLocations();
        if (manager.mainLocationSelect.options.length > 0) {
            console.log("‚úì –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π");
        }
    })();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–ª–æ–∫–∞—Ü–∏–π
    console.log("=== –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ª–æ–∫–∞—Ü–∏–π ===");
    await sleep(sleeper);
    await (async () => {
        const mainLocationId = manager.mainLocationSelect.value;
        await manager.loadSubLocations();
        if (manager.subLocationList.children.length > 0) {
            console.log("‚úì –ü–æ–¥–ª–æ–∫–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–¥–ª–æ–∫–∞—Ü–∏–π –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ " + mainLocationId);
        }
    })();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏
    console.log("=== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏ ===");
    await sleep(sleeper);
    await (async () => {
        const initialCount = manager.subLocationList.children.length;
        manager.addLocationBtn.click();
        await sleep(sleeper);
        manager.locationNameInput.value = "–¢–µ—Å—Ç–æ–≤–∞—è –õ–æ–∫–∞—Ü–∏—è";
        manager.saveLocationBtn.click();
        await sleep(sleeper);
        const newCount = manager.subLocationList.children.length;
        if (newCount > initialCount) {
            console.log("‚úì –õ–æ–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞");
        } else {
            exit("‚úó –õ–æ–∫–∞—Ü–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞");
        }
    })();


    //–û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ª–æ–∫–∞—Ü–∏—é
    console.log("=== –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏ ===");
    await sleep(sleeper);
    await (async () => {
        const locationToOpen = manager.subLocationList.lastElementChild;
        await manager.showEditPopup({
            'ID':locationToOpen.dataset.locationId,
            'name':locationToOpen.querySelector('.location-span').innerText,
        });
        await sleep(sleeper);

        if (manager.editPopup.style.display === 'block') {
            console.log("‚úì –õ–æ–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç–∞");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ª–æ–∫–∞—Ü–∏–∏");
        }
    })();

    //–û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ª–æ–∫–∞—Ü–∏—é
    console.log("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏ ===");
    await sleep(sleeper);
    await (async () => {
        let locationToOpen = manager.subLocationList.lastElementChild;
        const testText = '–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è'
        manager.editNameInput.value = testText;
        await manager.editLocationName();
        await sleep(sleeper);
        locationToOpen = manager.subLocationList.lastElementChild;
        if (locationToOpen.querySelector('.location-span').innerText===testText) {
            console.log("‚úì –õ–æ–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏");
        }
    })();


    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–∞ NPC
    console.log("=== –ü–æ–∏—Å–∫ NPC ===");
    await sleep(sleeper);
    await (async () => {
        manager.searchNpcInput.value = "–ì–æ–±–ª–∏–Ω"; // –ò–º—è NPC, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ—á–Ω–æ –µ—Å—Ç—å –≤ –±–∞–∑–µ
        manager.searchNpcInput.dispatchEvent(new Event('input'));
        await sleep(300 + sleeper);
        if (manager.searchNpcResults.children.length > 0) {
            console.log("‚úì –ü–æ–∏—Å–∫ NPC —Ä–∞–±–æ—Ç–∞–µ—Ç");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ NPC");
        }
    })();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è NPC –≤ –ª–æ–∫–∞—Ü–∏—é
    console.log("=== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ NPC –≤ –ª–æ–∫–∞—Ü–∏—é ===");
    await sleep(sleeper);
    await (async () => {
        const initialNpcCount = manager.editNpcList.children.length;
        const firstNpcResult = manager.searchNpcResults.firstElementChild;
        if (firstNpcResult) {
            firstNpcResult.click();
            await sleep(sleeper);
            const newNpcCount = manager.editNpcList.children.length;
            if (newNpcCount > initialNpcCount) {
                console.log("‚úì NPC —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ª–æ–∫–∞—Ü–∏—é");
            } else {
                exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ NPC –≤ –ª–æ–∫–∞—Ü–∏—é");
            }
        } else {
            exit("‚úó –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö NPC –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è");
        }
    })();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è NPC –∏–∑ –ª–æ–∫–∞—Ü–∏–∏
    console.log("=== –£–¥–∞–ª–µ–Ω–∏–µ NPC –∏–∑ –ª–æ–∫–∞—Ü–∏–∏ ===");
    await sleep(sleeper);
    await (async () => {
        const initialNpcCount = manager.editNpcList.children.length;
        const firstNpcInList = manager.editNpcList.querySelector('.location-del-npc');
        if (firstNpcInList) {
            firstNpcInList.click();
            await sleep(sleeper);
            const newNpcCount = manager.editNpcList.children.length;
            if (newNpcCount < initialNpcCount) {
                console.log("‚úì NPC —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω –∏–∑ –ª–æ–∫–∞—Ü–∏–∏");
            } else {
                exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ NPC –∏–∑ –ª–æ–∫–∞—Ü–∏–∏");
            }
        } else {
            exit("‚úó –ù–µ—Ç NPC –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è");
        }
    })();

    console.log("=== –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ø–∞–ø–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===");
    await sleep(sleeper);
    await (async () => {
        manager.showEditPopup({ ID: 1, name: "–¢–µ—Å—Ç–æ–≤–∞—è –õ–æ–∫–∞—Ü–∏—è" });
        await sleep(sleeper);
        manager.closePopup.click();
        if (manager.editPopup.style.display === 'none') {
            console.log("‚úì –ü–æ–ø–∞–ø —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç");
        } else {
            exit("‚úó –ü–æ–ø–∞–ø –Ω–µ –∑–∞–∫—Ä—ã–ª—Å—è");
        }
    })();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏
    console.log("=== –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ ===");
    await sleep(sleeper);
    await (async () => {
        const initialCount = manager.subLocationList.children.length;
        const locationToDelete = manager.subLocationList.lastElementChild.dataset.locationId;
        await manager.removeLocation(locationToDelete);
        await sleep(sleeper);
        const newCount = manager.subLocationList.children.length;
        if (newCount < initialCount) {
            console.log("‚úì –õ–æ–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏");
        }
    })();
}

---------------–ö–æ–¥ static\js\test\map.js:
import {exit, sleep} from './func.js'
import {showTab} from '../tabs.js'

export async function map(sleeper) {

    //–¢–µ—Å—Ç
    console.log("=== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ NPC –≤ –ª–æ–∫–∞—Ü–∏—é ===");
    await sleep(sleeper);
    await (async () => {
        if(1){
            console.log("‚úì –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω");
        } else {
            exit("‚úó –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è");
        }
    })();


}

---------------–ö–æ–¥ static\js\test\npc.js:
import {exit, sleep} from './func.js'
import {showTab} from '../tabs.js'

export async function npc(sleeper) {
    const manager = window.NpcManager;
    //–¢–µ—Å—Ç
    console.log("=== –ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–∞ NPC ===");
    await sleep(sleeper);
    await (async () => {
        manager.searchNpcInput.value = "–ì–æ–±–ª–∏–Ω"
        manager.searchNpcInput.dispatchEvent(new Event('input'));
        await sleep(sleeper + 300);
        const firstNpcResult = manager.searchNpcResults.firstElementChild;
        firstNpcResult.click()
        await sleep(sleeper);
        if(manager.npcCd.value && manager.npcName.value){
            console.log("‚úì –ü–æ–∏—Å–∫ –ù–ü–° –æ—Ç—Ä–∞–±–æ—Ç–∞–ª");
        } else {
            exit("‚úó –ü–æ–∏—Å–∫ –ù–ü–° –Ω–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª");
        }
    })();

    await sleep(sleeper);
    await (async () => {
        let count = document.querySelectorAll(".npc-item").length;
        manager.addNpcButton.click()
        await sleep(sleeper);

        if (count <  document.querySelectorAll(".npc-item").length){
            console.log("‚úì –ù–ü–° –¥–æ–±–∞–≤–ª–µ–Ω");
        } else {
            exit("‚úó –ù–ü–° –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω");
        }
    })();

    await sleep(sleeper);
    await (async () => {
        let info = document.querySelector(".npc-item:last-child .js-edit-npc");
        info.click()
        await sleep(sleeper);
        //–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–æ—Ä–º–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.
        if (manager.npcName.value !== ''){
            console.log("‚úì –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –ù–ü–° –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ñ–æ—Ä–º—É");
        } else {
            exit("‚úó –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –ù–ü–° –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ñ–æ—Ä–º—É");
        }
        // –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É
        let testName = '–¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂. –£–¥–∞–ª–∏—Ç—å';
        manager.npcName.value = testName;
        manager.updateNpcButton.click();
        await sleep(sleeper);

        // –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å
        let name = document.querySelector(".npc-item:last-child .js-npc-name").innerText;
        if (name === testName){
            console.log("‚úì –ù–ü–° –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω");
        } else {
            exit("‚úó –ù–ü–° –Ω–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω");
        }
    })();

    //–£–¥–∞–ª–µ–Ω–∏–µ –ù–ü–°
    await sleep(sleeper);
    await (async () => {
        const count = document.querySelectorAll(".npc-item").length;
        let del = document.querySelector(".npc-item:last-child .delete-btn");
        del.click()
        await sleep(sleeper);
        //–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–æ—Ä–º–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å.
        if (count > document.querySelectorAll(".npc-item").length){
            console.log("‚úì –ù–ü–° –£–¥–∞–ª–µ–Ω");
        } else {
            exit("‚úó –æ—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ù–ü–°");
        }
    })();

}


---------------–ö–æ–¥ static\js\test\tab.js:
import {exit, sleep} from './func.js'
export async function tab(sleeper) {

    //–¢–µ—Å—Ç
    await sleep(sleeper);
    await (async () => {
        let isTabActive = location.hash.replace('#','')==document.querySelector('.tab-content.active')?.id;
        if(isTabActive){
            console.log("‚úì id —Ç–∞–±–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ö—ç—à–µ–º");
        } else {
            exit("‚úó id —Ç–∞–±–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ö—ç—à–µ–º");
        }
    })();

}




